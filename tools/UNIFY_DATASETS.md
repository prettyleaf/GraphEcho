# Unified Dataset Format

This document describes the unified schema generated by `tools/unify_datasets.py`.

## Goal

Normalize scattered dataset folders into one machine-readable manifest with stable fields:

- `EchoNet-Dynamic` (`.avi`, EF/ESV/EDV targets)
- `CAMUS_public` (`.nii.gz` + `_gt.nii.gz`, split files)
- `cardiacUDC_dataset` (`*_image.nii.gz` and optional `*_label.nii.gz`)

The script auto-detects datasets in either:
- `<root>/<dataset_name>`
- `<root>/datasets/<dataset_name>`

## Algorithm

1. Discover supported dataset roots under `--root`.
2. Parse each dataset with dataset-specific rules:
   - EchoNet: read `FileList.csv`, map `FileName -> Videos/<name>.avi`, extract EF/ESV/EDV/FPS.
   - CAMUS: parse `database_nifti/*/*.nii.gz`, pair image and `_gt` mask, map patient split from `database_split/*.txt`.
   - cardiacUDC: scan `*_image.nii.gz`, pair with sibling `*_label.nii.gz` when present.
3. Convert all samples to one schema (`sample_id`, `dataset`, `split`, `task`, paths, metadata).
4. Save unified artifacts:
   - `manifest.csv` (full row-level catalog)
   - `summary.json` (counts and missing labels/images)
5. Optional: materialize data into `output/data/<sample_id>/` with `copy`, `hardlink`, or `symlink`.

## Schema

`manifest.csv` fields:

- `sample_id`
- `dataset`
- `split`
- `task`
- `modality`
- `source_image`
- `source_label`
- `unified_image`
- `unified_label`
- `patient_id`
- `view`
- `phase`
- `site`
- `target_ef`
- `target_esv`
- `target_edv`
- `fps`
- `num_frames`
- `frame_height`
- `frame_width`
- `notes`

## Usage

Build manifest only:

```bash
python tools/unify_datasets.py --root . --output unified_dataset --mode manifest
```

Materialize unified files via hardlinks:

```bash
python tools/unify_datasets.py --root . --output unified_dataset --mode hardlink
```

Materialize by copying:

```bash
python tools/unify_datasets.py --root . --output unified_dataset --mode copy
```

Overwrite existing files in `output/data`:

```bash
python tools/unify_datasets.py --root . --output unified_dataset --mode hardlink --overwrite
```
